{"ast":null,"code":"var _jsxFileName = \"/Users/ryandi/Documents/projects/react/game-of-life-functional/src/NewGame.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport './NewGame.css';\nimport HistoryStack from './HistoryStack';\nimport Tips from './Tips';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Cell(props) {\n  _s();\n\n  let left = props.size * props.x + 1;\n  let top = props.size * props.y + 1;\n  let size = props.size - 1;\n  const [color] = useState(props.color);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Cell\",\n    style: {\n      left,\n      top,\n      width: size,\n      height: size,\n      backgroundColor: `rgb(${color.r}, ${color.g}, ${color.b})`\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 12,\n    columnNumber: 3\n  }, this);\n}\n\n_s(Cell, \"42HK6m5AIr09a8SaL6H1DD9LG0o=\");\n\n_c = Cell;\n\nfunction Board(props) {\n  let boardRef = /*#__PURE__*/React.createRef();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Board\",\n    style: {\n      width: props.size * props.cols,\n      height: props.size * props.rows,\n      backgroundSize: `${props.size}px ${props.size}px`\n    },\n    ref: boardRef,\n    onClick: event => {\n      const pos = getClickPosition(event);\n      props.onClick(pos.x, pos.y);\n    },\n    children: props.cells.map(cell => /*#__PURE__*/_jsxDEV(Cell, {\n      x: cell.x,\n      y: cell.y,\n      color: cell.color,\n      size: props.size\n    }, `${cell.y}, ${cell.x}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 5\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 29,\n    columnNumber: 3\n  }, this);\n\n  function getClickPosition(event) {\n    const rect = boardRef.current.getBoundingClientRect();\n    const offX = event.clientX - rect.left;\n    const offY = event.clientY - rect.top;\n    const x = Math.floor(offX / props.size);\n    const y = Math.floor(offY / props.size);\n    return {\n      x,\n      y\n    };\n  }\n}\n\n_c2 = Board;\nexport default function Game(props) {\n  _s2();\n\n  const prevBtn = /*#__PURE__*/React.createRef();\n  const [board, setBoard] = useState(makeEmptyBoard(props.rows, props.cols));\n  const [cells, setCells] = useState([]);\n  const [prev, setPrev] = useState(false);\n  const [running, setRunning] = useState(false);\n  const [history] = useState(new HistoryStack(props.steps));\n  const [runTimeout, setRunTimeout] = useState(null); // update the cells whenever the board gets updated\n\n  useEffect(() => {\n    if (!prev) {\n      setCells(makeCells());\n    }\n\n    setPrev(false);\n    console.log('board changed, setting cells');\n  }, [board]); // update the `Prev` button status whenever cells get updated\n\n  useEffect(() => {\n    console.log('changing the cells now');\n\n    if (history.size === 0) {\n      prevBtn.current.disabled = true;\n    } else {\n      prevBtn.current.disabled = false;\n    }\n  }, [cells]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Tips, {\n      width: props.size * props.cols,\n      steps: props.steps\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(Board, {\n      cells: cells,\n      size: props.size,\n      rows: props.rows,\n      cols: props.cols,\n      onClick: (x, y) => handleClick(x, y)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"controls\",\n      style: {\n        width: props.size * props.cols\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        ref: prevBtn,\n        onClick: getPrevBoard,\n        children: \"Prev\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: getNextBoard,\n        children: \"Next\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: toggleRun,\n        children: running ? 'Pause' : 'Run'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: reset,\n        children: \"Reset\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true);\n\n  function handleClick(x, y) {\n    if (x >= 0 && x < props.cols && y >= 0 && y <= props.rows) {\n      board[y][x] = !board[y][x];\n    }\n\n    setCells(makeCells());\n  }\n\n  function makeCells() {\n    let cells = [];\n\n    for (let y = 0; y < props.rows; y++) {\n      for (let x = 0; x < props.cols; x++) {\n        if (board[y][x]) cells.push({\n          x,\n          y,\n          color: randomColor()\n        });\n      }\n    }\n\n    return cells;\n  }\n\n  function getNextBoard() {\n    history.push({\n      cells: cells.slice(),\n      board: board.map(row => row.slice())\n    });\n    let newBoard = board.map(row => row.slice());\n\n    for (let y = 0; y < props.rows; y++) {\n      for (let x = 0; x < props.cols; x++) {\n        let neighbors = numberOfNeighbors(board, x, y);\n\n        if (newBoard[y][x]) {\n          newBoard[y][x] = neighbors === 2 || neighbors === 3;\n        } else {\n          if (!board[y][x] && neighbors === 3) {\n            newBoard[y][x] = true;\n          }\n        }\n      }\n    }\n\n    setBoard(newBoard);\n  }\n\n  function getPrevBoard() {\n    if (history.size > 0) {\n      let {\n        cells,\n        board\n      } = history.pop();\n      setPrev(true);\n      setBoard(board);\n      setCells(cells);\n    }\n  }\n\n  function toggleRun() {\n    if (runTimeout === null) {\n      const ttHandler = window.setTimeout(() => {\n        getNextBoard();\n      }, 500);\n      setRunTimeout(ttHandler);\n      setRunning(true);\n    } else {\n      window.clearTimeout(runTimeout);\n      setRunTimeout(null);\n      setRunning(false);\n    }\n  }\n\n  function reset() {\n    clearInterval(runTimeout);\n    setBoard(makeEmptyBoard(props.rows, props.cols));\n    setCells([]);\n    history.clear();\n    setRunInterval(null);\n  }\n\n  function numberOfNeighbors(b, x, y) {\n    let neighbors = 0;\n    const dirs = [[-1, -1], [-1, 0], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 0], [1, 1]];\n\n    for (let [offY, offX] of dirs) {\n      let _y = y + offY;\n\n      let _x = x + offX;\n\n      if (_x >= 0 && _x < props.cols && _y >= 0 && _y < props.rows && b[_y][_x]) neighbors++;\n    }\n\n    return neighbors;\n  }\n} // utilities\n\n_s2(Game, \"VgptYgk379Tf1b6gqXiKBlnsFgM=\");\n\n_c3 = Game;\n\nfunction randomColor() {\n  const rc = () => 30 + Math.floor(Math.random() * 200);\n\n  return {\n    r: rc(),\n    g: rc(),\n    b: rc()\n  };\n}\n\nfunction makeEmptyBoard(rows, cols) {\n  let results = [];\n\n  for (let y = 0; y < rows; y++) {\n    results.push([]);\n\n    for (let x = 0; x < cols; x++) {\n      results[y].push(false);\n    }\n  }\n\n  return results;\n}\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"Cell\");\n$RefreshReg$(_c2, \"Board\");\n$RefreshReg$(_c3, \"Game\");","map":{"version":3,"sources":["/Users/ryandi/Documents/projects/react/game-of-life-functional/src/NewGame.js"],"names":["React","useEffect","useState","HistoryStack","Tips","Cell","props","left","size","x","top","y","color","width","height","backgroundColor","r","g","b","Board","boardRef","createRef","cols","rows","backgroundSize","event","pos","getClickPosition","onClick","cells","map","cell","rect","current","getBoundingClientRect","offX","clientX","offY","clientY","Math","floor","Game","prevBtn","board","setBoard","makeEmptyBoard","setCells","prev","setPrev","running","setRunning","history","steps","runTimeout","setRunTimeout","makeCells","console","log","disabled","handleClick","getPrevBoard","getNextBoard","toggleRun","reset","push","randomColor","slice","row","newBoard","neighbors","numberOfNeighbors","pop","ttHandler","window","setTimeout","clearTimeout","clearInterval","clear","setRunInterval","dirs","_y","_x","rc","random","results"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport './NewGame.css';\nimport HistoryStack from './HistoryStack';\nimport Tips from './Tips';\n\nfunction Cell(props) {\n\tlet left = props.size * props.x + 1;\n\tlet top = props.size * props.y + 1;\n\tlet size = props.size - 1;\n\tconst [color] = useState(props.color);\n\treturn (\n\t\t<div\n\t\t\tclassName=\"Cell\"\n\t\t\tstyle={{\n\t\t\t\tleft,\n\t\t\t\ttop,\n\t\t\t\twidth: size,\n\t\t\t\theight: size,\n\t\t\t\tbackgroundColor: `rgb(${color.r}, ${color.g}, ${color.b})`,\n\t\t\t}}\n\t\t/>\n\t);\n}\n\nfunction Board(props) {\n\tlet boardRef = React.createRef();\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"Board\"\n\t\t\tstyle={{\n\t\t\t\twidth: props.size * props.cols,\n\t\t\t\theight: props.size * props.rows,\n\t\t\t\tbackgroundSize: `${props.size}px ${props.size}px`,\n\t\t\t}}\n\t\t\tref={boardRef}\n\t\t\tonClick={(event) => {\n\t\t\t\tconst pos = getClickPosition(event);\n\t\t\t\tprops.onClick(pos.x, pos.y);\n\t\t\t}}\n\t\t>\n\t\t\t{props.cells.map((cell) => (\n\t\t\t\t<Cell\n\t\t\t\t\tx={cell.x}\n\t\t\t\t\ty={cell.y}\n\t\t\t\t\tcolor={cell.color}\n\t\t\t\t\tsize={props.size}\n\t\t\t\t\tkey={`${cell.y}, ${cell.x}`}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</div>\n\t);\n\n\tfunction getClickPosition(event) {\n\t\tconst rect = boardRef.current.getBoundingClientRect();\n\t\tconst offX = event.clientX - rect.left;\n\t\tconst offY = event.clientY - rect.top;\n\t\tconst x = Math.floor(offX / props.size);\n\t\tconst y = Math.floor(offY / props.size);\n\t\treturn {\n\t\t\tx,\n\t\t\ty,\n\t\t};\n\t}\n}\n\nexport default function Game(props) {\n\tconst prevBtn = React.createRef();\n\tconst [board, setBoard] = useState(makeEmptyBoard(props.rows, props.cols));\n\tconst [cells, setCells] = useState([]);\n\tconst [prev, setPrev] = useState(false);\n\tconst [running, setRunning] = useState(false);\n\tconst [history] = useState(new HistoryStack(props.steps));\n\tconst [runTimeout, setRunTimeout] = useState(null);\n\n\t// update the cells whenever the board gets updated\n\tuseEffect(() => {\n\t\tif (!prev) {\n\t\t\tsetCells(makeCells());\n\t\t}\n\t\tsetPrev(false);\n\t\tconsole.log('board changed, setting cells');\n\t}, [board]);\n\n\t// update the `Prev` button status whenever cells get updated\n\tuseEffect(() => {\n\t\tconsole.log('changing the cells now');\n\t\tif (history.size === 0) {\n\t\t\tprevBtn.current.disabled = true;\n\t\t} else {\n\t\t\tprevBtn.current.disabled = false;\n\t\t}\n\t}, [cells]);\n\n\treturn (\n\t\t<>\n\t\t\t<Tips width={props.size * props.cols} steps={props.steps} />\n\t\t\t<Board\n\t\t\t\tcells={cells}\n\t\t\t\tsize={props.size}\n\t\t\t\trows={props.rows}\n\t\t\t\tcols={props.cols}\n\t\t\t\tonClick={(x, y) => handleClick(x, y)}\n\t\t\t/>\n\t\t\t<div className=\"controls\" style={{ width: props.size * props.cols }}>\n\t\t\t\t<button className=\"btn\" ref={prevBtn} onClick={getPrevBoard}>\n\t\t\t\t\tPrev\n\t\t\t\t</button>\n\t\t\t\t<button className=\"btn\" onClick={getNextBoard}>\n\t\t\t\t\tNext\n\t\t\t\t</button>\n\t\t\t\t<button className=\"btn\" onClick={toggleRun}>\n\t\t\t\t\t{running ? 'Pause' : 'Run'}\n\t\t\t\t</button>\n\t\t\t\t<button className=\"btn\" onClick={reset}>\n\t\t\t\t\tReset\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</>\n\t);\n\n\tfunction handleClick(x, y) {\n\t\tif (x >= 0 && x < props.cols && y >= 0 && y <= props.rows) {\n\t\t\tboard[y][x] = !board[y][x];\n\t\t}\n\t\tsetCells(makeCells());\n\t}\n\n\tfunction makeCells() {\n\t\tlet cells = [];\n\t\tfor (let y = 0; y < props.rows; y++) {\n\t\t\tfor (let x = 0; x < props.cols; x++) {\n\t\t\t\tif (board[y][x]) cells.push({ x, y, color: randomColor() });\n\t\t\t}\n\t\t}\n\t\treturn cells;\n\t}\n\n\tfunction getNextBoard() {\n\t\thistory.push({\n\t\t\tcells: cells.slice(),\n\t\t\tboard: board.map((row) => row.slice()),\n\t\t});\n\t\tlet newBoard = board.map((row) => row.slice());\n\t\tfor (let y = 0; y < props.rows; y++) {\n\t\t\tfor (let x = 0; x < props.cols; x++) {\n\t\t\t\tlet neighbors = numberOfNeighbors(board, x, y);\n\t\t\t\tif (newBoard[y][x]) {\n\t\t\t\t\tnewBoard[y][x] = neighbors === 2 || neighbors === 3;\n\t\t\t\t} else {\n\t\t\t\t\tif (!board[y][x] && neighbors === 3) {\n\t\t\t\t\t\tnewBoard[y][x] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsetBoard(newBoard);\n\t}\n\n\tfunction getPrevBoard() {\n\t\tif (history.size > 0) {\n\t\t\tlet { cells, board } = history.pop();\n\t\t\tsetPrev(true);\n\t\t\tsetBoard(board);\n\t\t\tsetCells(cells);\n\t\t}\n\t}\n\n\tfunction toggleRun() {\n\t\tif (runTimeout === null) {\n\t\t\tconst ttHandler = window.setTimeout(() => {\n\t\t\t\tgetNextBoard();\n\t\t\t}, 500);\n\t\t\tsetRunTimeout(ttHandler);\n\t\t\tsetRunning(true);\n\t\t} else {\n\t\t\twindow.clearTimeout(runTimeout);\n\t\t\tsetRunTimeout(null);\n\t\t\tsetRunning(false);\n\t\t}\n\t}\n\n\tfunction reset() {\n\t\tclearInterval(runTimeout);\n\t\tsetBoard(makeEmptyBoard(props.rows, props.cols));\n\t\tsetCells([]);\n\t\thistory.clear();\n\t\tsetRunInterval(null);\n\t}\n\n\tfunction numberOfNeighbors(b, x, y) {\n\t\tlet neighbors = 0;\n\t\tconst dirs = [\n\t\t\t[-1, -1],\n\t\t\t[-1, 0],\n\t\t\t[-1, 1],\n\t\t\t[0, -1],\n\t\t\t[0, 1],\n\t\t\t[1, -1],\n\t\t\t[1, 0],\n\t\t\t[1, 1],\n\t\t];\n\n\t\tfor (let [offY, offX] of dirs) {\n\t\t\tlet _y = y + offY;\n\t\t\tlet _x = x + offX;\n\n\t\t\tif (_x >= 0 && _x < props.cols && _y >= 0 && _y < props.rows && b[_y][_x])\n\t\t\t\tneighbors++;\n\t\t}\n\t\treturn neighbors;\n\t}\n}\n\n// utilities\nfunction randomColor() {\n\tconst rc = () => 30 + Math.floor(Math.random() * 200);\n\treturn {\n\t\tr: rc(),\n\t\tg: rc(),\n\t\tb: rc(),\n\t};\n}\n\nfunction makeEmptyBoard(rows, cols) {\n\tlet results = [];\n\tfor (let y = 0; y < rows; y++) {\n\t\tresults.push([]);\n\t\tfor (let x = 0; x < cols; x++) {\n\t\t\tresults[y].push(false);\n\t\t}\n\t}\n\treturn results;\n}\n"]},"metadata":{},"sourceType":"module"}